!function(){function e(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function t(t){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?e(Object(s),!0).forEach((function(e){o(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function o(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const{jQuery:n,ajaxurl:s,Swal:c,Vue:r,docspress_admin_vars:i}=window,a=i.__,l={customClass:"docspress-swal",showClass:{popup:"swal2-noanimation",backdrop:"swal2-noanimation"},hideClass:{popup:"",backdrop:""}};function d(e){const t=Object.assign([],e),o={0:{name:"",docs:[]}};return t.forEach((e=>{o["".concat(e.post.cat_id)]||(o["".concat(e.post.cat_id)]={name:e.post.cat_name,docs:[]}),o[e.post.cat_id].docs.push(e)})),o}function p(e,t){for(let o=0;o<e.length;o++)e[o].post.id===t?e.splice(o,1):e[o].child&&e[o].child.length&&(e[o].child=p(e[o].child,t));return e}r.directive("sortable",{bind:function(e){const t=n(e);t.sortable({stop:function(e,t){const o=[];n(t.item.closest("ul")).children("li").each((function(e,t){o.push(n(t).data("id"))})),n.post(s,{action:"docspress_sortable_docs",ids:o,_wpnonce:i.nonce})},cursor:"move"}),t.on("mousedown",(function(){n(this).css("min-height",n(this).height())})),t.on("mouseup",(function(){n(this).css("min-height","")}))}}),new r({el:"#docspress-app",data:{editurl:"",viewurl:"",docs:[],categorized:[]},mounted(){const e=this,t=n(e.$el);this.editurl=i.editurl,this.viewurl=i.viewurl,e.docs=[],n.get(s,{action:"docspress_admin_get_docs",_wpnonce:i.nonce},(function(o){let{data:n}=o;t.find(".docspress").removeClass("not-loaded").addClass("loaded"),t.find(".spinner").remove(),t.find(".no-docspress").removeClass("not-loaded"),e.docs=Object.assign([],n),e.categorized=d(n)}))},methods:{onError:function(e){c.showValidationMessage("Request failed: ".concat(e.message||e.statusText||e.responseText||e)),console.log(e)},addDoc:function(){const e=this;c.fire(t({title:a.enter_doc_title,input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,inputPlaceholder:a.enter_doc_title,preConfirm:t=>!1!==t&&n.post(s,{action:"docspress_create_doc",title:t,parent:0,_wpnonce:i.nonce}).done((t=>{if(!t||!t.success||!t.data)return!1;e.docs.unshift(t.data),e.categorized=d(e.docs)})).fail(e.onError)},l))},cloneDoc:function(e){const o=this;c.fire(t({title:a.enter_doc_title,input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,inputPlaceholder:a.enter_doc_title,inputValue:a.clone_default_title.replace("%s",e.post.title),preConfirm:t=>!1!==t&&n.post(s,{action:"docspress_clone_doc",title:t,clone_from:e.post.id,_wpnonce:i.nonce}).done((e=>{if(!e||!e.success||!e.data)return!1;o.docs.unshift(e.data),o.categorized=d(o.docs)})).fail(o.onError)},l))},removeDoc:function(e){const o=this;c.fire(t({title:a.remove_doc_title,text:a.remove_doc_text,icon:"question",showCancelButton:!0,confirmButtonText:a.remove_doc_button_yes,showLoaderOnConfirm:!0,preConfirm:()=>o.removePost(e)},l))},exportDoc:function(e){const o=this;c.fire(t({title:a.clone_default_title.replace("%s","<strong>"+e.post.title+"</strong>"),html:a.export_doc_text,icon:"info",showCancelButton:!0,confirmButtonText:a.export_doc_button_yes},l)).then((function(){c.fire(t({title:a.exporting_doc_title,html:'<div class="docspress-export-response">'+a.exporting_doc_text+'</div><div class="docspress-export-progress"><div class="docspress-export-progress-bar"></div></div>',icon:"info",showCancelButton:!0,showConfirmButton:!1},l)).then((function(){p.close()}));const r=n(".docspress-export-response"),i=n(".docspress-export-progress .docspress-export-progress-bar");let d=0;const p=new window.EventSource(s+"?action=docspress_export_doc&doc_id="+e.post.id);p.onmessage=function(e){const o=JSON.parse(e.data);switch(console.log(o),o.action){case"message":d++,r.text(o.message),i.css("width",100*d/o.max_delta+"%");break;case"complete":p.close(),c.fire(t({title:a.exported_doc_title,html:'<a class="button button-primary button-hero" href="'+o.message+'">'+a.exported_doc_download+"</a>",icon:"success",showCancelButton:!0,showConfirmButton:!1,closeOnCancel:!1,cancelButtonText:a.exported_doc_cancel},l))}},p.onerror=function(){o.onError(this),p.close()}}))},addSection:function(e){const o=this;c.fire(t({title:a.enter_section_title,input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,inputPlaceholder:a.enter_section_title,preConfirm:t=>!1!==t&&n.post(s,{action:"docspress_create_doc",title:t,parent:e.post.id,order:e.child.length,_wpnonce:i.nonce}).done((t=>{if(!t||!t.success||!t.data)return!1;e.child.push(t.data)})).fail(o.onError)},l))},removeSection:function(e){const o=this;c.fire(t({title:a.remove_section_title,text:a.remove_section_text,icon:"question",showCancelButton:!0,confirmButtonText:a.remove_section_button_yes,showLoaderOnConfirm:!0,preConfirm:()=>o.removePost(e)},l))},addArticle:function(e,o){const r=o,d=this;c.fire(t({title:a.enter_doc_title,input:"text",showCancelButton:!0,showLoaderOnConfirm:!0,inputPlaceholder:a.enter_doc_title,preConfirm:t=>!1!==t&&n.post(s,{action:"docspress_create_doc",title:t,parent:e.post.id,status:"draft",order:e.child.length,_wpnonce:i.nonce}).done((t=>{if(!t||!t.success||!t.data)return!1;e.child.push(t.data);const o=n(r.target).closest(".section-title").next();o.hasClass("collapsed")&&o.removeClass("collapsed")})).fail(d.onError)},l))},removeArticle:function(e){const o=this;c.fire(t({title:a.remove_article_title,text:a.remove_article_text,icon:"question",showCancelButton:!0,confirmButtonText:a.remove_article_button_yes,showLoaderOnConfirm:!0,preConfirm:()=>o.removePost(e)},l))},removePost:function(e){const t=this;return n.post(s,{action:"docspress_remove_doc",id:e,_wpnonce:i.nonce}).done((o=>{if(!o||!o.success)return!1;t.docs=p(t.docs,e),t.categorized=d(t.docs)})).fail(t.onError)},toggleCollapse:function(e){e.preventDefault(),n(e.target).closest(".section-title").toggleClass("collapsed").siblings("ul.articles").toggleClass("collapsed")}}})}();